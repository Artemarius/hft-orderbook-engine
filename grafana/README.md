# Grafana Dashboard for HFT Orderbook Engine

Visualize market microstructure analytics from the replay engine using InfluxDB 2.7 and Grafana 11.4.

## Prerequisites

- Docker and Docker Compose
- Python 3.7+ with pip
- Analytics data generated by the replay engine

## Quick Start

### One-Command Launch

**Windows (PowerShell):**
```powershell
.\grafana\scripts\launch.ps1

# Or generate fresh analytics data first:
.\grafana\scripts\launch.ps1 -Replay
```

**Linux / WSL2:**
```bash
chmod +x grafana/scripts/launch.sh
./grafana/scripts/launch.sh

# Or generate fresh analytics data first:
./grafana/scripts/launch.sh --replay
```

### Manual Steps

```bash
# 1. Generate analytics data (if not already done)
./build/replay --input data/btcusdt_l3_sample.csv --analytics \
  --analytics-csv data/analytics.csv --analytics-json data/analytics.json

# 2. Start containers
docker compose -f grafana/docker-compose.yml up -d

# 3. Install Python dependencies
pip install -r grafana/scripts/requirements.txt

# 4. Ingest data into InfluxDB
python grafana/scripts/ingest.py \
  --csv data/analytics.csv \
  --json data/analytics.json \
  --drop

# 5. Open dashboard
# http://localhost:3000
```

## Dashboards

### HFT Orderbook Overview (`http://localhost:3000`)

The main dashboard with 10 panels across 4 rows:

| Row | Panels |
|---|---|
| **Summary Stats** | Trade Count, Avg Spread (gauge), Kyle's Lambda, Tick Volatility |
| **Price & Spread** | Trade Price & Microprice overlay, Bid-Ask Spread (bps) |
| **Order Flow** | Order Flow Imbalance, Depth Imbalance, Aggressor Distribution (pie) |
| **Volatility** | Realized Volatility (full width) |

### Depth & Impact (`/d/hft-depth-impact`)

Secondary dashboard with:
- Price impact stats (Kyle's Lambda, temporary, permanent)
- Spread comparison (quoted vs effective, min/max)
- Bid/Ask depth profile bar charts (avg quantity by level)
- Trade volume by aggressor side

## Architecture

```
replay --analytics-csv/--analytics-json
        |
        v
  data/analytics.csv + data/analytics.json
        |
        v
  ingest.py (influxdb-client)
        |
        v
  InfluxDB 2.7 (localhost:8086) — "analytics" bucket
        |
        v
  Grafana 11.4 (localhost:3000) — pre-provisioned dashboards
```

### InfluxDB Data Model

| Measurement | Source | Points |
|---|---|---|
| `trades` | CSV (one row per trade) | ~1,000 for sample data |
| `summary` | JSON (aggregate stats) | 1 |
| `depth_profile` | JSON (per-level depth) | up to 20 (10 levels x 2 sides) |

### Services

| Service | Image | Port | Notes |
|---|---|---|---|
| InfluxDB | `influxdb:2.7` | 8086 | Auto-setup, token: `hft-dev-token` |
| Grafana | `grafana/grafana-oss:11.4.0` | 3000 | Anonymous access, no login needed |

## Configuration

Default credentials (development only):
- **InfluxDB:** org=`hft-engine`, bucket=`analytics`, token=`hft-dev-token`
- **Grafana:** Anonymous viewer access enabled (no login required)

All defaults can be overridden via `ingest.py` arguments:
```
python ingest.py --url http://localhost:8086 --token <token> --org <org> --bucket <bucket>
```

## Teardown

```bash
docker compose -f grafana/docker-compose.yml down -v
```

The `-v` flag removes the InfluxDB data volume for a clean restart.
